services:
  perplexity-api:
    build: .
    container_name: perplexity-api-server
    ports:
      - "8088:8088"
    volumes:
      # Persist browser profile (login session)
      - ./browser-profile:/root/.perplexity-browser-profile
      # Persist session data
      - ./data:/app/data
    environment:
      - DISPLAY=:99
    # Xvfb is already installed in the image, but we can run it if needed
    # The server will handle browser initialization
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8088/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 60s

